<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="author" content="Ken Webb" />
    <meta name="copyright" content="MIT License, Copyright (C) 2019 Ken Webb" />
    
    <script src="xholon/lib/antlr4-require.js"></script>
    
    <!--                                                               -->
    <!-- Consider inlining CSS to reduce the number of requested files -->
    <!--                                                               -->
    <link type="text/css" rel="stylesheet" href="Xholon.css">

    <style>
    pre.antlr {
      border-style: solid;
      border-width: 1px;
      background-color: aliceblue;
    }
    #tree {
        margin-left: 50px;
        float:left;
        clear:right;
    }
    #inputs {
        float:left;
        clear:left;
    }
    .roomElement {
        background: beige;
        /*display: inline-block;*/
        padding: 5px;
        border-radius: 12px;
        border: 1px solid black;
        margin: 10px;
    }
    </style>
    
    <title>Xholon ANTLR - Cypher</title>
    
    <!-- D3 -->
    <script type="text/javascript" language="javascript" src="d3.min.js" charset="utf-8"></script>
    
    <!--                                           -->
    <!-- This script loads your compiled module.   -->
    <!-- If you add any GWT meta tags, they must   -->
    <!-- be added before this line.                -->
    <!--                                           -->
    <script type="text/javascript" language="javascript" src="xholon/xholon.nocache.js"></script>
    
  </head>
  
  <body>
    <!--<h3>Xholon ANTLR - Cypher</h3>-->
    
    <!-- OPTIONAL: include this if you want history support -->
    <!--<iframe src="javascript:''" id="__gwt_historyFrame" tabIndex='-1' style="position:absolute;width:0;height:0;border:0"></iframe>-->
    
    <!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
    <noscript>
      <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
        Your web browser must have JavaScript enabled
        in order for this application to display correctly.
      </div>
    </noscript>

    <!-- Each of the following can have sub-div elements. -->
    <div id="xhtop">
      <h3 id="xholontitle" style="display: inline;">Xholon</h3>
      <span id="timestep" style="padding-left: 20px; font-size: 13px;">0</span>:<span id="maxprocessloops" style="font-size: 13px;">&infin;</span>
    </div>
    
    <!-- default GWT-based GUI -->
    <div id="xhgui"></div>
    
    <!-- reserved for app-specific use -->
    <div id="xhappspecific"></div>
    
    <div id="xhconsole">
      <!--<div id="xhout"></div> will be added as a tab in a TabLayoutPanel -->
      <!--<div id="xhclipboard"></div>  will be added as a tab in a TabLayoutPanel -->
      <!-- instances of node-specific XholonConsole -->
    </div>
    
    <!-- text: much of which could use CodeMirror/Ace -->
    <div id="xhtabs"></div>
    
    <!-- data: line chart, pie chart, other Google charts, etc. -->
    <div id="xhchart"></div>
    
    <!-- HTML5 canvas -->
    <div id="xhcanvas"></div>
    
    <!-- structure: network, tree, Google/D3 Treemap, D3 charts/graphs, etc. -->
    <div id="xhgraph">
      <div id="networkview"></div>
      <div id="treeview"></div>
      <div id="xhtreemap"></div>
    </div>
    
    <!-- SVG and other animations, such as those with Animate.java
         Each separate animation should have its own child div -->
    <div id="xhanim"></div>
    
    <!-- static SVG images -->
    <div id="xhsvg"></div>
    
    <!-- PNG, etc. -->
    <div id="xhimg"></div>
    
    <!-- Include Zepto with a script tag near the end of your page. -->
    <!--<script src="zepto.min.js"></script>-->
    
    <!-- QUnit unit testing -->
    <div id="xhunittest">
      <!-- these are required by QUnit -->
      <div id="qunit"></div>
      <div id="qunit-fixture"></div>
    </div>

    <!-- http://127.0.0.1:8888/XholonAntlr_Cypher.html?app=HelloWorld&gui=clsc -->
    <!--<p>This is an <a href="">Cypher</a> model.</p>-->
    <!--<pre class="antlr">
Cypher grammar
    </pre>-->
    
    <div id="inputs">
      <!--
// example from: https://neo4j.com/developer/cypher-basics-i/
//data stored with this direction
CREATE (p:Person)-[:LIKES]->(t:Technology)

//query relationship backwards will not return results
MATCH (p:Person)<-[:LIKES]-(t:Technology)

//better to query with undirected relationship unless sure of direction
MATCH (p:Person)-[:LIKES]-(t:Technology)    
      -->
      <textarea style = "display: none;" id="xhcypher">
CREATE (abc)
</textarea>
      <br/>
      <button id="parse">Parse</button>
    </div>
    
    <script type="text/javascript">
var updateTree = function(tree, ruleNames) {
  console.log(ruleNames);
  var nodeTypeT = ruleNames[tree.ruleIndex];
  console.log(nodeTypeT);
  switch (nodeTypeT) {
  case "oC_Cypher":
    xmlStrCSH += "<XholonNull>\n";
    break;
  default:
    break;
  }
  for (var i = 0; i < tree.children.length; i++) {
    var child = tree.children[i];
    console.log(child);
    var nodeType = ruleNames[child.ruleIndex];
    if (nodeType) {
      console.log(nodeType);
    }
    else {
      console.log(child.getText());
    }
    switch (nodeType) {
    case "oC_SP":
      console.log("an oC_SP");
      break;
    case "oC_Statement":
      console.log("an oC_Statement");
      break;
    case null:
    case undefined:
      break;
    default:
      console.log(nodeType);
      break;
    } // end switch
  }
  switch (nodeTypeT) {
  case "oC_Cypher":
    xmlStrCSH += "</XholonNull>";
    break;
  default:
    break;
  }
};

var recurseChild = function(child, ruleNames, indent) {
  if (!child) {return;}
  var nodeType = ruleNames[child.ruleIndex];
  console.log(nodeType);
  switch (nodeType) {
  case "aaa":
    //aaa(child, ruleNames, indent);
    break;
  case "bbb":
    //bbb(child, ruleNames, indent);
    return;
  case "ccc":
    //ccc(child, ruleNames, indent);
    return;
  case "ddd":
    //ddd(child, ruleNames, indent);
    return;
  case "eee":
    //eee(child, ruleNames, indent);
    return;
  default:
    break;
  }
  if (child.children) {
    for (var j = 0; j < child.children.length; j++) {
      console.log("" + j + " " + child.children[j].getText());
      recurseChild(child.children[j], ruleNames, indent + "  ");
    }
  }
}

var aaa = function(node, ruleNames, indent) {
  var parent = node.parentCtx;
  var nodeType = ruleNames[parent.ruleIndex];
  switch (nodeType) {
  case "ggg":
    console.log("This is a ggg");
    break;
  case "hhh":
    console.log("This is a hhh");
    return;
  default:
    break;
  }
  
  switch(node.children[0].getText()) {
  case "iii":
    // 
    return;
  case "jjj":
    break;
  default:
    break;
  }
}

var antlr4 = require('xholon/lib/antlr4/index');
var CypherLexer = require('xholon/lib/antlr4g/CypherLexer');
var CypherParser = require('xholon/lib/antlr4g/CypherParser');
var CypherListener = require('xholon/lib/antlr4g/CypherListener');

var xmlStrIH = "<_-.XholonClass>\n  <TheSystem/>\n";
var xmlStrCD = "<xholonClassDetails>\n";
var xmlStrCSH = "<TheSystem>";

var nextActivityId = 1;
var actorClassContextName = null;
var transArr = null;
var seekingTopActor = false;

// behavior for one specific StateMachine, for an ActorClass with a Behavior
var beh = null;
var bindings = {}; //[]; // cache all Binding(s) here
var actorRefObj = null;

document.getElementById("parse").addEventListener("click", function(){
  var input = document.getElementById("xhcypher").value;
  var chars = new antlr4.InputStream(input);
  var lexer = new CypherLexer.CypherLexer(chars);
  var tokens  = new antlr4.CommonTokenStream(lexer);
  var parser = new CypherParser.CypherParser(tokens);
  parser.buildParseTrees = true;
  console.log(parser);
  var tree = parser.oC_Cypher();
  console.log("Parsed: "+ tree);
  updateTree(tree, parser.ruleNames);
  //
  xmlStrIH += "</_-.XholonClass>\n";
  xmlStrCD += '\n'
    + '  <XholonClass xhType="XhtypePureContainer"/>\n'
    ;
  xmlStrCD += "</xholonClassDetails>\n";
  xmlStrCSH += "</TheSystem>\n";
  console.log(xmlStrIH);
  console.log(xmlStrCD);
  console.log(xmlStrCSH);
  console.log(bindings);
  if (xh) {
    var rootIH = xh.app().first().next().next().first().next().first();
    console.log(rootIH);
    rootIH.append(xmlStrIH);
    rootIH.append(xmlStrCD);
    var rootCSH = xh.root();
    console.log(rootCSH);
    rootCSH.append(xmlStrCSH);
  }
  if (beh) {
    // write out the last behavior
    console.log(beh);
  }
});

    </script>
    
    <!--<div id="tree"></div>-->
    
    <div id="xhfooter">
    <hr/>
    <div class="license"  style="font-size: 9px;"><p>Xholon GWT is a <a href="index.html">Xholon</a> project. Copyright (C) 2017 Ken Webb</p></div>
    <div class="aatt" style="font-size: 9px;"><pre style="font-size: 9px;">
  @QWERTYUIk
  OPASmDFGHe
  primordion
  JKLZcXCVB.
    </pre></div>

  </body>
  
</html>
