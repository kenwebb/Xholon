<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="author" content="Ken Webb" />
    <meta name="copyright" content="MIT License, Copyright (C) 2016-2018 Ken Webb" />
    <style>
.wrtcurl {font-family: monospace; font-size: 14px;}
.wrtcid0 {background-color: rgba(255, 0, 0, 0.2);}
.wrtcid1 {background-color: rgba(0, 255, 0, 0.2);}
.wrtcid2 {background-color: rgba(0, 0, 255, 0.2);}
pre, .wrtcurl {background-color: rgb(235, 235, 235);}
    </style>
    <title>Xholon WebRTC Apps</title>
  </head>
  
  <body>
    <h3>Xholon WebRTC Apps</h3>
    <p>WebRTC (Web Real-Time Communication) is a peer-to-peer technology that directly connects browser applications. <a href="https://en.wikipedia.org/wiki/WebRTC">WebRTC</a> support is built into Google Chrome, Mozilla Firefox, and other modern browsers which I have not yet tested.</p>
    <p>This web page describes my initial test and demo of WebRTC, using 2 Xholon apps, with each app running in its own web page. I live in the province of Ontario in Canada, and I began putting this experiment together while visiting a friend in St. Gallen canton in Switzerland (Schweiz). The demo is based on exchanging text messages between Canadian province objects and Swiss canton objects. I use the <a href="https://peerjs.com/">PeerJS</a> JavaScript client library to simplify my interactions with WebRTC, and I also use the <a href="https://peerjs.com/peerserver">PeerJS signaling server</a> to help set up the connections between browsers. <a href="http://www.primordion.com/Xholon/gwt/index.html">Xholon</a> is an open-source project with a <a href="https://github.com/kenwebb/Xholon">github repository</a>.</p>
    <!-- see my notebook for April 29, 2016 -->
    
    <h3>Quick Test</h3>
    <p>Open <a href="XholonWebRTC.html?app=d6eada52b8a14384ebdec837f7356ba7&src=gist&gui=none&localid0=Able102&localid1=Baker102&localid2=Charlie102">this</a>, and then <a href="XholonWebRTC.html?app=9c111d1ffac80a6905964d9433a532b7&src=gist&gui=none&remoteid0=Able102&remoteid2=Charlie102">this</a> in separate new browser tabs or windows, and observe the exchange of messages between the two browser-based apps.</p>
    
    <h3>Demo - Step 1 - Start Canada app</h3>
    <p>Start the <a href="XholonWebRTC.html?app=d6eada52b8a14384ebdec837f7356ba7&src=gist&gui=none&localid0=Able101&localid1=Baker101&localid2=Charlie101">Canada</a> app in Firefox or Chrome. Alternatively, you can edit the localid parameters below, and drag, or copy and paste, the result into a browser URL line.</p>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=d6eada52b8a14384ebdec837f7356ba7&src=gist&gui=none&localid0=<span class="wrtcid0">Able101</span>&localid1=<span class="wrtcid1">Baker101</span>&localid2=<span class="wrtcid2">Charlie101</span></div>
    <p>The resulting page should look similar to the following. The GUI includes a <a href="https://d3js.org/">D3</a> <a href="https://en.wikipedia.org/wiki/Circle_packing">Circle Packing</a> (d3cp) animated SVG-based visualization, with abbreviated names inside each circle.</p>
    <img src="images/webrtcCanadaStart.png"/>
    
    <h3>Demo - Step 2 - Start Schweiz app</h3>
    <p>Start the <a href="XholonWebRTC.html?app=9c111d1ffac80a6905964d9433a532b7&src=gist&gui=none&remoteid0=Able101&remoteid2=Charlie101">Schweiz</a> app in another Firefox or Chrome page. This second page can use the same browser as the first page (Chrome or Firefox)), or a different browser, and it can run on the same computer or on a different computer. Alternatively, you can edit the remoteid parameters below, and drag, or copy and paste, the result into a browser URL line. Note that the value for remoteid0 must match the value for localid0 in the Canada app, and the same for the other IDs.</p>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=9c111d1ffac80a6905964d9433a532b7&src=gist&gui=none&remoteid0=<span class="wrtcid0">Able101</span>&remoteid2=<span class="wrtcid2">Charlie101</span></div>
    <p>Once this second page has loaded, the two apps should start to exchange regular test messages, as shown in the following.</p>
    <img src="images/webrtcSchweizStart.png"/>
    <p>Note that each app includes an Avatar, displayed in a light reddish color inside the Ontario object and inside the StGallen object. You can instruct an Avatar to move between the two apps, and perform various actions along the way.</p>
    
    <h3>Demo - Step 3 - Exchange Gifts between the apps</h3>
    <p>Paste the following script into either Avatar. The easiest way to do this is to highlight the entire text starting with &lt;script> and ending with &lt;/script>, drag this to the running app, and drop it directly on the Avatar object.</p>
    <pre contenteditable="true">
&lt;script>
var a = this.parent();
a.action("script;\nbuild Gift;\ntake gift;\ngo port0;\nlook;\ndrop gift;\ngo port0;\n");
&lt;/script></pre>
    <p>The Avatar will acquire a gift, will carry it through a port to the other app, will leave the gift there, and will then return home. All of this activity will animate within the two D3 Circle Packing (d3cp) GUIs.</p>
    <p>Note that the scripting language used by the Avatar (IFLang), is loosely based on actions in the <a href="https://www.inform-fiction.org">Inform 6</a> interactive fiction (IF) language. In a distributed environment, Avatar commands must be separated using "\n" so that they will be executed at subsequent timesteps rather than all at the same time. By following this convention, some of the commands will execute in the home browser, and others will execute in the remote browser.</p>
    <p>As shown in the following image, the script was dropped on the Avatar in Ontario in Canada, and ended up in StGallen in Schweiz.</p>
    <img src="images/webrtcExchangeGifts.png"/>
    
    <h3>Demo - Step 4 - Monitor</h3>
    <p>Optionally run the <a href="PeerjsChat.html">PeerJS Chat</a> app in another browser window. Enter a localid in the "Connect to a peer:" field, for example enter Baker101 and press "Connect", to monitor that object.</p>
    <p>You can also enter some XML into the "Enter message" field, and press "Send to selected peers". For example, &lt;One> will create a new object of type One in the monitored app. &lt;One>&lt;Two/>&lt;Three/>&lt;/One> will create a small subtree with Two and Three objects inside a One container. Each line below includes some separate content that can be sent to the peer.</p>
    <pre contenteditable="true">
&lt;Orange>&lt;Color>orange&lt;/Color>&lt;/Orange>
&lt;Attribute_String>How are things on the other side?&lt;/Attribute_String>
&lt;Four>&lt;Anno>Four is a fantastic number. It's twice as wonderful as two!&lt;/Anno>&lt;/Four>
    </pre>
    <img src="images/webrtcMonitor.png"/>
    
    <h3>Demo - Step 5</h3>
    <p>In this step, Schweiz will create a container node with some arbitrary contents. Avatar will move from Canada to Schweiz, will take a container node, will return to Canada, and will smash the container to reveal the contents. As you can see, I was trying to learn some German.</p>
    
    <p>Highlight and drag the following content, to the StGallen node in the Schweiz app.</p>
    <pre contenteditable="true">
&lt;container>
  &lt;Ort roleName="Heim das">
    &lt;Ort roleName="Haus das">
      &lt;Ort roleName="Keller der"/>
      <!-- erste -->
      &lt;Ort roleName="KÃ¼che die"/>
      &lt;Ort roleName="Wohnzimmer das"/>
      &lt;Ort roleName="Esszimmer das"/>
      &lt;Ort roleName="Pianozimmer das"/>
      &lt;Ort roleName="Badezimmer das"/>
      <!-- zweite -->
      &lt;Ort roleName="Schlafzimmer das" multiplicity="3"/>
      &lt;Ort roleName="Badezimmer das">
        &lt;Ort roleName="Dusche die"/>
        &lt;Ort roleName="Badewanne die"/>
      &lt;/Ort>
    &lt;/Ort>
    &lt;Ort roleName="Garten der"/>
    &lt;Ort roleName="Veranda die"/>
    &lt;Ort roleName="Garage die"/>
  &lt;/Ort>
&lt;/container></pre>
    
    <p>Then highlight and drag the following content, to the Avatar node in the Canada app. The Avatar will take the container with all of its contents, and move it back to its home where it will remove (smash) the outer container.</p>
    <pre contenteditable="true">
&lt;script>
var a = this.parent();
a.action("script;\ngo port0;\ntake container;\ngo port0;\ndrop container;\nsmash container;\n");
&lt;/script></pre>
    <p>OR you can have the Avatar just take a clone, and leave the original intact.</p>
    <pre contenteditable="true">
&lt;script>
var a = this.parent();
a.action("script;\ngo port0;\ntakeclone container;\ngo port0;\ndrop container;\nsmash container;\n");
&lt;/script></pre>
        
    <div>
    <p>
    This final screenshot shows parts of three browser windows.
    The left window is the "Schweiz" app running in Firefox.
    The center window is the "Canada" app running in Google Chrome.
    The right window is an early version of this web page, with highlighted "orange" content about to be added to one of the other two windows.
    </p>
    <img src="images/webrtcContainerClone.png"/>
    </div>
    
    <hr/>
    <h3>Developer Links</h3>
    <p>I test the Xholon software using a local server. I'm including these additional URLs for my own convenience.</p>
    <!-- Canada -->
    <p>Canada</p>
    <a href="XholonWebRTC.html?app=WebRTC+complex+Canada+2018&src=lstr&gui=none&localid0=Able101&localid1=Baker101&localid2=Charlie101">WebRTC complex Canada 2018 (localstorage)</a>
    <div class="wrtcurl" contenteditable="true">http://127.0.0.1:8888/XholonWebRTC.html?app=WebRTC+complex+Canada+2018&src=lstr&gui=none&localid0=<span class="wrtcid0">Able101</span>&localid1=<span class="wrtcid1">Baker101</span>&localid2=<span class="wrtcid2">Charlie101</span></div>
    <div class="wrtcurl" contenteditable="true">http://127.0.0.1:8888/XholonWebRTC.html?app=d6eada52b8a14384ebdec837f7356ba7&src=gist&gui=none&localid0=<span class="wrtcid0">Able101</span>&localid1=<span class="wrtcid1">Baker101</span>&localid2=<span class="wrtcid2">Charlie101</span></div>
    <!-- Schweiz -->
    <p>Schweiz</p>
    <a href="XholonWebRTC.html?app=WebRTC+complex+Schweiz+2018&src=lstr&gui=none&remoteid0=Able101&remoteid2=Charlie101">WebRTC complex Schweiz 2018 (localstorage)</a>
    <div class="wrtcurl" contenteditable="true">http://127.0.0.1:8888/XholonWebRTC.html?app=WebRTC+complex+Schweiz+2018&src=lstr&gui=none&remoteid0=<span class="wrtcid0">Able101</span>&remoteid2=<span class="wrtcid2">Charlie101</span></div>
    <div class="wrtcurl" contenteditable="true">http://127.0.0.1:8888/XholonWebRTC.html?app=9c111d1ffac80a6905964d9433a532b7&src=gist&gui=none&remoteid0=<span class="wrtcid0">Able101</span>&remoteid2=<span class="wrtcid2">Charlie101</span></div>
    
    <p>Links to the Xholon editor for each app</p>
    <p><a href="wb/editwb.html?app=d6eada52b8a14384ebdec837f7356ba7&src=gist">WebRTC complex Canada 2018 (gist)</a></p>
    <p><a href="wb/editwb.html?app=9c111d1ffac80a6905964d9433a532b7&src=gist">WebRTC complex Schweiz 2018 (gist)</a></p>
    <p><a href="wb/editwb.html?app=WebRTC%20complex%20Canada%202018&src=lstr">WebRTC complex Canada 2018 (localstorage)</a></p>
    <p><a href="wb/editwb.html?app=WebRTC%20complex%20Schweiz%202018&src=lstr">WebRTC complex Schweiz 2018 (localstorage)</a></p>
    
    <p>Links to Xholon workbook at github for each app</p>
    <p><a href="https://gist.github.com/kenwebb/d6eada52b8a14384ebdec837f7356ba7">WebRTC complex Canada 2018 (view at github)</a></p>
    <p><a href="https://gist.github.com/kenwebb/9c111d1ffac80a6905964d9433a532b7">WebRTC complex Schweiz 2018 (view at github)</a></p>

    <h3>Scenarios</h3>
    <p>Things that can be sent to another App include: the current IXholon inventory (and/or subtrees) of an Avatar, Avatar IFLang instructions, a Xholon &lt;script as XML and JavaScript (security issues), text, JSON, JavaScript Object, etc./></p>
    <ol>
    <li>App1 node sends displayable text to App2 node, for display in "out" tab or elsewhere.</li>
    <li>App1 system-Avatar (Avatar1) moves to App2, performing local actions within App1, and then remote actions within App2, and then local actions on return to App1. On return, it is still the same Avatar.</li>
    <li>App1 non-system-Avatar does the same thing as in the previous scenario.</li>
    <li>App2 system-Avatar does the same thing as in the previous scenarios.</li>
    <li>App1 Avatar and App2 Avatar interact with each other.</li>
    <li>Avatars or other nodes within App1 and App2 send messages to each other through webrtc.</li>
    <li>Chat page sends content String, XML String, and JSON content to a node in App1.</li>
    <li>Avatar1 moves to App2, does something, and stays there. User2 has Avatar1 do something, sends it back to App1, and has it do something else back there.</li/>
    <li>Establish a ring of webrtc connections amongst at least three apps. Have Avatar1 continuously navigate the ring, possibly doing things along the way such as picking up items that local users may have created. Avatar1 could drop off certain types of items, or users along the way could take some of these items.</li>
    <li>Avatar1 delivers certain items to specific apps along its ring or route. Address items in some way, possibly using XML attributes, or Xholon IMessage nodes.</li>
    <li>Avatar1 moves to App2, queries a database (ex: IndexDB), returns home with the result, and does something with the result.</li>
    <li>Avatar1 explores a remote site, and returns with a map showing its discoveries.</li>
    <li>Avatar1 moves to App2, obtains a PNG image, returns with it, and displays it.</li>
    <li>Allow people to send text messages to each other.</li>
    <li>Play a d3cp "video" of what is happening at another site.</li>
    <li>Implement multi-player Island game using webrtc.</li>
    </ol>
    
    <h3>Islands Game with WebRTC</h3>
    <p>Run any or all of the following URLs, in separate browsers and/or on different computers.</p>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=40731e8f7a7ece0236e656fb24036e4a&apprev=17&src=gist&gui=none&hide=xhtop,xhtabs,xhsvg,xhfooter&localid0=<span class="wrtcid0">Daniel101</span></div>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=40731e8f7a7ece0236e656fb24036e4a&apprev=17&src=gist&gui=none&hide=xhtop,xhtabs,xhsvg,xhfooter&localid0=<span class="wrtcid1">Johann101</span></div>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=40731e8f7a7ece0236e656fb24036e4a&apprev=17&src=gist&gui=none&hide=xhtop,xhtabs,xhsvg,xhfooter&localid0=<span class="wrtcid2">Jules101</span></div>
    <p>Run each app for awhile, and then collect data by pressing the "$" key (remember to press the Shift key). Then press "p" to continue. Make sure you do this separately for each app.</p>
    
    <p>Run the WebRTC Island Admin tool, on whatever browser and computer you want.</p>
    <div class="wrtcurl" contenteditable="true">http://www.primordion.com/Xholon/gwt/XholonWebRTC.html?app=0c07551a85b220eb6fc7c8a8d2b6a10b&src=gist&gui=none&remoteid0=<span class="wrtcid0">Daniel101</span>&remoteid1=<span class="wrtcid1">Johann101</span>&remoteid2=<span class="wrtcid2">Jules101</span></div>
    <p>Drag the following script into the Avatar.</p>
    <pre contenteditable="true">
&lt;script>
var a = this.parent();
a.action("script;\ngo port0;\ntakeclone dataExport;\ngo port0;\ndrop dataExport;\n");
&lt;/script></pre>
    <p>The Avatar will vanish, and should return a short time later with the data in a "DataExport" node.</p>
    <p>Move the Avatar to each of the other "Player" nodes, and drag the same script into the Avatar while it's there.</p>
    
    <hr/>
    <p>Ken Webb</p>
    <div class="license"  style="font-size: 9px;"><p>Xholon GWT is a <a href="index.html">Xholon</a> project. Copyright (C) 2016 - 2018 Ken Webb</p></div>
    <div class="aatt" style="font-size: 9px;"><pre style="font-size: 9px;">
  @QWERTYUIk
  OPASmDFGHe
  primordion
  JKLZcXCVB.
    </pre></div>
  </body>
</html>
